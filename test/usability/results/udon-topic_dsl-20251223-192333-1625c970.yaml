---
id: udon-topic_dsl-20251223-192333-1625c970
task: 'Topic DSL: Data contracts'
test_type: topic_dsl
context_lines: 0
model: claude-sonnet-4-5-20250929
prompt: |
  ## Context

  You're participating in notation design research. This is a one-shot
  interaction—you won't receive a reply, but your response will be
  reviewed by humans. Please prioritize honesty over any attempt to
  please; skepticism and criticism are valuable.

  ## UDON: Universal Document & Object Notation

  UDON unifies data, documents, and configuration in one syntax. The key
  insight: most real content is **mixed**—prose with structured data woven
  throughout, not segregated into "data files" vs "documents."

  Here is a comprehensive example showing UDON's capabilities:

  ```udon
  ; ============================================================================
  ; UDON Comprehensive Syntax Example
  ; Exercises the full specification (excluding exotic number types)
  ; ============================================================================

  ; ----------------------------------------------------------------------------
  ; MIXINS — Class-only elements define reusable traits
  ; ----------------------------------------------------------------------------

  |.base-service
    :version 1.0
    :timeout 30
    :retries 3

  |.logging :log-level info :log-format json

  |.cached
    :cache-enabled true
    :cache-ttl 3600

  ; ----------------------------------------------------------------------------
  ; CONFIGURATION — Data-centric usage
  ; ----------------------------------------------------------------------------

  |config[app-config]
    :name        "My Application"
    :debug       false
    :environment !{env.APP_ENV}

    ; Database with structured credentials
    |database[primary].base-service
      :adapter postgres
      :host    db.example.com
      :port    5432
      :pool    10
      :ssl

      |credentials
        :username !{env.DB_USER}
        :password !{env.DB_PASS}

    ; Cache inherits from multiple mixins
    |cache[redis].base-service.logging.cached
      :host cache.example.com
      :port 6379

    ; Feature flags demonstrate various value types
    |features
      :enabled-flags [dark-mode notifications beta-features]
      :rate-limits [100 500 1000]
      :mixed-example [42 true "hello" nil]
      :empty-list []

    ; Absent vs nil vs false demonstration
    |nil-test
      :flag-present           ; true (flag with no value)
      :explicit-true   true   ; true
      :explicit-false  false  ; false
      :null-value      null   ; nil (JSON style)
      :nil-value       nil    ; nil (Ruby style)
      :tilde-value     ~      ; nil (YAML style)
      ; :absent-key is not here — it's absent, not nil

  ; ----------------------------------------------------------------------------
  ; SCHEMA — Using element suffixes for DSL semantics
  ; ----------------------------------------------------------------------------

  |schema[user]
    :description "User account schema"
    |field[id]!                     :type integer :auto-increment
    |field[email]!                  :type string  :format email :unique
    |field[name]?                   :type string  :max-length 100
    |field[roles]*                  :type string  :enum [admin user guest]
    |field[primary-role]+           :type string
    ; Suffix position variations
    |field?[optional-with-id]       :type string
    |field[another-id]? .searchable :type string

  ; ----------------------------------------------------------------------------
  ; DOCUMENT — Prose-centric usage with embedded structure
  ; ----------------------------------------------------------------------------

  |article[welcome-guide]
    :author Joseph Wecker
    :date 2025-12-22
    :tags [udon tutorial documentation]
    :status published

    |h1 Welcome to UDON

    UDON is a **unified notation** for data, documents, and configuration.
    The key insight: most real content is |{em mixed}—not purely data
    |{em or} purely prose, but |{dfn :id mixed-content mixed content} where
    structure appears |{ul inline} exactly where it's needed.

    Consider this paragraph: it contains |{abbr :title "Application Programming Interface" API}
    references, |{a :href #getting-started internal links}, and even
    |{data :value 42 :type metric a structured data point} all flowing
    naturally within the prose.

    ## Why Another Format?

    Existing formats force uncomfortable trade-offs. See the comparison
    in |{a :href #format-comparison Table 1} below:

    |table[format-comparison]   ; Obviously this could just be a markdown table instead, but demoing more structure
      |tr      |{th Format}     |{th Prose} |{th Data}  |{th Inline}
      |tr      |{td JSON}       |{td poor}  |{td great} |{td none}
      |tr      |{td YAML}       |{td poor}  |{td good}  |{td none}
      |tr      |{td XML}        |{td ok}    |{td ok}    |{td verbose}
      |tr      |{td Markdown}   |{td great} |{td poor}  |{td limited}
      |tr.emph |{td |{em UDON}} |{td great} |{td great} |{td |{em natural}}

    As |{cite :author "Kay" :year 1993 Alan Kay} noted in his work on
    Smalltalk: |{q the best notation is one you don't notice}. UDON aims
    for exactly this—structure that doesn't interrupt reading.

    |blockquote
      :source "Ancient Proverb"
      :cited-by |{a :href https://example.com Source}

      The best notation is the one that gets out of your way
      while keeping your data safe.

    |section[getting-started]
      :level 2

      ### Your First UDON File

      Here's what makes UDON special—you can explain things in natural
      prose while embedding |{code :lang udon |server :host localhost}
      inline, or break out to a full example:

      !code :udon
        |server
          :host localhost
          :port 8080

      The |{code "|"} prefix marks structure. The |{code ":"} prefix marks
      attributes. Everything else is just prose. For inline elements,
      use |{code "|{element content}"} syntax.

      ### Escaping Special Characters

      Sometimes you need literal prefix characters:

      '|this is not an element — it's prose starting with a pipe
      ':this is not an attribute — just text with a colon
      ';this is not a comment — semicolons in prose
      ''and this shows a literal apostrophe

      Back to normal prose here.

    |section[advanced-topics]
      :level 2

      ### Inline Nesting vs Embedded Elements

      Two syntaxes for different purposes:

      |div |span |strong Rightward nesting ; children nest rightward

      |p Prose with |{em emphasis}, |{strong |{em nested} formatting}, and
         |{a :href /doc :title "Full documentation" the |{em official} docs}.

      The first uses |{code |element} for structural nesting. The second
      uses |{code "|{element}"} for inline content within prose—crucial
      for |{dfn :id mixed-content-def documents where structure and prose
      are interwoven}.

      ### Navigation Example

      |nav.main |{a :href / Home} |{a :href /about About} |{a :href /docs Docs} |{a :href /contact Contact}

      ### Code Samples

      Use |{code !code} for non-UDON content:

      !code :elixir
        defmodule Example do
          def hello do
            # This pipe is Elixir, not UDON
            "world" |> String.upcase()
          end
        end

      !code :sql
        SELECT u.name, u.email
        FROM users u
        WHERE u.active = true
          AND u.created_at > '2025-01-01'
        ORDER BY u.name;

  ; ----------------------------------------------------------------------------
  ; TEMPLATE — Dynamic content with control flow
  ; ----------------------------------------------------------------------------

  |template[page-layout]
    :doctype html5

    !include partials/head

    |html :lang !{locale | default "en"}
      |head
        |meta :charset utf-8
        |title !{page.title} — !{site.name}

        !for stylesheet in stylesheets
          |link :rel stylesheet :href !{stylesheet}

        !if page.has_custom_css |style !{page.custom_css}

      |body :class !{body_classes | join " "}

        |header
          !include partials/nav

          !if announcements
            |div.announcements
              !for announcement in announcements
                |div.announcement :class !{announcement.type}
                  !{announcement.message | escape}

        |main[content]
          !if user
            |section.welcome
              Welcome back, !{user.name | capitalize}!

              !if user.is_admin
                |div.admin-notice You have !{pending_tasks | size} pending admin tasks.
              !elif user.is_moderator
                |div.mod-notice Moderation queue: !{mod_queue | size} items
              !else Your last login: !{user.last_login | format "%B %d, %Y"}

          !else
            |section.guest
              |p Welcome, guest!
              |a :href /login Please sign in
              |span or
              |a :href /register create an account

          !let featured = posts | where "featured" true | first
            !if featured
              |article.featured
                |h2 !{featured.title}
                !{featured.excerpt | truncate 200}

          |section.posts
            !for post in posts
              |article :id post-!{post.id}
                |h3 |a :href /posts/!{post.id} !{post.title}
                |p.meta
                  By !{post.author.name} on !{post.date | format "%Y-%m-%d"}
                |p !{post.excerpt}

        !include partials/footer

  ; ----------------------------------------------------------------------------
  ; COMPLEX ATTRIBUTES — Structured values under attributes
  ; ----------------------------------------------------------------------------

  |api-endpoint[create-user]
    :method POST
    :path /api/users
    :auth required

    :headers
      |header :name Content-Type :value application/json
      |header :name X-API-Version :value "2025-01"
      |header :name Authorization :value Bearer !{token}

    :request-body
      |field[email] :type string :required
      |field[password] :type string :required :min-length 8
      |field[name] :type string

    :responses
      |response :status 201 :description "User created"
      |response :status 400 :description "Validation error"
      |response :status 409 :description "Email already exists"

  ; ----------------------------------------------------------------------------
  ; REFERENCES — ID references for reuse
  ; ----------------------------------------------------------------------------

  ; Two forms of ID reference:
  ;   @[id] — Insert entire element (structure + content)
  ;   :[id] — Merge only attributes from that element

  |license[mit]
    MIT License

    Copyright (c) 2025 Joseph Wecker

    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files...

  |license[apache-2]
    Apache License, Version 2.0

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License...

  ; @[id] — Full element insertion
  |project[udon-parser]
    :name "UDON Parser"
    :version 0.7.0
    :license @[mit]              ; Inserts the full |license[mit] element here
    :homepage https://github.com/example/udon
    :authors ["Joseph Wecker" "Contributors"]
    :keywords [parser notation data documents]

  |project[udon-tools]
    :name "UDON Tools"
    :version 0.1.0
    :license @[apache-2]
    :dependencies
      |dep :name udon-parser :version "~> 0.7"

  ; :[id] — Attribute merge (like mixin but via ID)
  |.db-defaults[base-db]
    :adapter postgres
    :host localhost
    :pool 5
    :timeout 30

  ; Merge base-db attributes, then override/add specific ones
  |database[dev]  :[base-db] :database myapp_dev  :pool  2
  |database[prod] :[base-db] :database myapp_prod :pool 20 :ssl

  ; ----------------------------------------------------------------------------
  ; EMBEDDED ELEMENTS AND EDGE CASES
  ; ----------------------------------------------------------------------------

  |edge-cases

    ; --- Embedded element variations ---
    |p Simple |{em emphasis} in prose.
    |p Multiple: |{em one}, |{strong two}, and |{code three}.
    |p With attributes: |{a :href /foo :title "Link title" click here} works.
    |p Nested: |{strong This is |{em very} important} stuff.
    |p Complex: See |{a :href /doc the |{em official} |{code API} docs} for details.

    ; --- Structural variations ---
    |empty                               ; Empty element
    |.just-classes.another-class         ; Classes only (mixin definition)
    |[only-id]                           ; ID only
    |outer :a 1 |middle :b 2 |inner :c 3 Content here ; Chained inline

    ; --- Value type edge cases ---
    |test-values
      :simple-list [one two three]
      :with-spaces ["hello world" "foo bar" simple]
      :mixed-types [42 3.14 true null "string"]
      :empty-list  []
      :single      [only-one]

    ; --- Deeply nested structure ---
    |level-1 |level-2 |level-3 |level-4 :deep true Finally at the bottom!

    ; Same thing expanded:
    |level-1
      |level-2
        |level-3
          |level-4
            :deep true
            Finally at the bottom!

  ; ----------------------------------------------------------------------------
  ; REAL-WORLD EXAMPLE — Technical documentation with embedded data
  ; ----------------------------------------------------------------------------

  |doc[api-guide].technical
    :version 2.1.0
    :last-updated 2025-12-22
    :authors ["Joseph Wecker" "Contributors"]

    ## Authentication

    All API requests require a bearer token. Obtain one from the
    |{a :href /oauth OAuth endpoint} using your |{code client_id} and
    |{code client_secret}.

    |endpoint[auth-token] :method POST :path /oauth/token
      :rate-limit |{limit :requests 10 :window 60s}

      Request an access token. Returns |{code :type response token} valid
      for |{duration :seconds 3600 one hour}.

    Token format: |{code Bearer <token>}. Include in the
    |{code Authorization} header of all subsequent requests.

    ## User Endpoints

    The |{code /users} resource supports full |{abbr :title "Create, Read, Update, Delete" CRUD}
    operations. All responses include |{field :name _links :type object HAL-style links}.

    |endpoint[create-user] :method POST :path /users
      :auth required
      :rate-limit |{limit :requests 100 :window 60s}

      Creates a new user. The |{field :name email :required} field must be
      unique. Optional fields include |{field :name name}, |{field :name avatar_url},
      and |{field :name metadata :type object}.

      |example :type request
        |{code-block :lang json {"email": "alice@example.com", "name": "Alice"}}

      |example :type response :status 201
        |{code-block :lang json {"id": "usr_abc123", "email": "alice@example.com"}}

      Possible errors:
        |error :code 400 validation failed,
        |error :code 409 email already exists.

    ## Rate Limiting

    All endpoints are rate-limited. When you exceed the limit, the API returns
    |{status :code 429 Too Many Requests} with a |{header :name Retry-After}
    header indicating seconds until the limit resets.

    Current limits by tier:
    '| Tier       | Requests/min | Burst    |
    '|------------|--------------|----------|
    '| Free       | |{n 60}      | |{n 10}  |  ; It is assumed that inlines like |{..} are
    '| Pro        | |{n 600}     | |{n 100} |  ;   processed before any markdown rendering/processing
    '| Enterprise | |{n 6000}    | |{n 1000}|


    For higher limits, |{a :href /contact contact sales} or see the
    |{a :href /docs/enterprise Enterprise documentation}.

  ; ----------------------------------------------------------------------------
  ; TRIPLE-BACKTICK ESCAPE (Rare — for edge cases only)
  ; ----------------------------------------------------------------------------

  |raw-example
    :description "Sometimes you need to break free of indentation"

    Here's content that uses the rare triple-backtick escape ```
  This content ignores indentation rules entirely.
      We can start wherever we want.
    Go back to column 0.
  |this-pipe-is-literal-text-not-an-element
  :this-colon-too
  ```

    Back to normal UDON parsing now.

  ; ============================================================================
  ; End of comprehensive example
  ; ============================================================================

  ```

  ## Your Task

  The following term was pulled randomly from a grab-bag of tech/AI/HCI
  buzzwords to spark potentially novel and creative usage scenarios:

  **Data contracts**

  Explore any unexpected connections or potential applications:

  1. Does UDON's mixed prose+structure model offer anything useful here?
  2. Any surprising synergies you notice?
  3. Would practitioners in this area benefit, or is UDON irrelevant?

  **Think especially in terms of novel DSLs that UDON could uniquely facilitate.**
  UDON offers multiple "tiers of voice" (prose, elements, inline elements,
  attributes, comments, templating) that could serve as a substrate for
  domain-specific languages. What DSL might emerge for this domain?

  Think freely. We're looking for genuine insight, not forced connections.
  If UDON is genuinely unhelpful for this domain, say so directly.

  ---

  ## Feedback (Optional)

  After your main response, you're welcome to share additional thoughts:

  ```
  # FEEDBACK:
  # Your thoughts here...
  ```
response: "# Data Contracts & UDON: Unexpected Synergies\n\n## 1. The Core Opportunity:
  Executable Documentation\n\nData contracts suffer from a **documentation-implementation
  gap**. Teams write:\n- Schema definitions (JSON Schema, Protobuf, Avro)\n- Human
  documentation explaining intent, business rules, edge cases\n- Migration guides\n-
  Example payloads\n- Validation rules\n- SLAs and operational constraints\n\nThese
  live in separate files, drift apart, and lack a unified narrative. UDON's mixed
  prose+structure model could create **contracts as literate programs** where the
  specification *is* the documentation, and vice versa.\n\n## 2. A Novel DSL: Contract-Driven
  Documentation\n\n```udon\n|contract[user-service-events].v2\n  :provider user-service\n
  \ :consumers [analytics-pipeline recommendation-engine billing-service]\n  :stability
  stable\n  :breaking-change-policy \"30-day notice required\"\n\n  ## User Registration
  Event\n\n  When a user completes registration, we emit a |{event user.registered}\n
  \ event. This happens |{em after} email verification but |{em before}\n  the welcome
  email is sent, giving downstream services a ~200ms window\n  to enrich the user
  profile.\n\n  |schema[user.registered]\n    :version 2.1.0\n    :since 2024-03-15\n
  \   :deprecated-fields [legacy_id]\n\n    The event carries the following fields:\n\n
  \   |field[user_id]! \n      :type uuid\n      :description \"Immutable user identifier\"\n
  \     :example \"550e8400-e29b-41d4-a716-446655440000\"\n      \n      This ID is
  |{em stable across all services}. Never use email as\n      an identifier—users
  can change emails, and we support multiple\n      emails per account as of |{version
  2.0.0}.\n\n    |field[email]!\n      :type string\n      :format email\n      :pii
  true\n      :retention-policy \"delete after account closure + 30 days\"\n      \n
  \     The |{em primary} email. As of v2.1, users may have additional\n      emails
  in the |{field emails} array (see below).\n\n    |field[emails]*\n      :type array\n
  \     :items-type string\n      :since 2.1.0\n      :example [\"alice@example.com\",
  \"alice@work.com\"]\n      \n      |{warn :breaking-change \"In v3.0 (2025-Q3),
  the singular |{code email}\n      field will be removed. All consumers must migrate
  to using |{code emails}\n      array by 2025-09-01.\"}\n\n    |field[registered_at]!\n
  \     :type timestamp\n      :format iso8601\n      :timezone UTC\n      \n      Timestamp
  of registration |{em completion}, not initial signup.\n      For funnel analysis,
  see the |{event user.signup_started} event instead.\n\n    |field[acquisition]?\n
  \     :type object\n      :nullable true\n      \n      Attribution data. May be
  |{code null} for organic signups or when\n      tracking is blocked.\n\n      |field[source]?
  :type string :enum [organic paid referral partner]\n      |field[campaign_id]? :type
  string\n      |field[referrer_id]? :type uuid\n      \n      |constraint\n        If
  |{code source} is |{code referral}, then |{code referrer_id}\n        |{em must}
  be present. Our validation allows null |{code campaign_id}\n        for organic
  referrals—see |{issue PLAT-2847} for the rationale.\n\n  ## Backward Compatibility
  Guarantees\n\n  |compatibility-matrix\n    :current-version 2.1.0\n\n    We maintain
  |{strong strict backward compatibility} within major versions:\n\n    |rule[additive-only]
  :severity MUST\n      New fields may be added with |{code ?} (optional) or |{code
  *} (array)\n      suffixes only. Never add required fields to existing events.\n\n
  \   |rule[deprecation-window] :severity MUST\n      Deprecated fields remain functional
  for |{duration :days 180 180 days}\n      after deprecation notice. We emit |{header
  X-Deprecated-Field} warnings\n      in development environments.\n\n    |rule[enum-extension]
  :severity MAY\n      Enums may add new values. Consumers |{em must} handle unknown
  enum values\n      gracefully (treat as |{code other} or log and skip).\n\n  ##
  Examples\n\n  ### Minimal Event (v2.1)\n\n  !code :json\n    {\n      \"user_id\":
  \"550e8400-e29b-41d4-a716-446655440000\",\n      \"email\": \"alice@example.com\",\n
  \     \"emails\": [\"alice@example.com\"],\n      \"registered_at\": \"2025-12-22T14:30:00Z\",\n
  \     \"acquisition\": null\n    }\n\n  ### With Attribution (v2.1)\n\n  !code :json\n
  \   {\n      \"user_id\": \"660f9511-f3ab-52e5-b827-557766551111\",\n      \"email\":
  \"bob@work.com\",\n      \"emails\": [\"bob@work.com\", \"bob@personal.com\"],\n
  \     \"registered_at\": \"2025-12-22T15:45:00Z\",\n      \"acquisition\": {\n        \"source\":
  \"paid\",\n        \"campaign_id\": \"summer_2025\"\n      }\n    }\n\n  ## Consumer
  Responsibilities\n\n  Services consuming this event |{strong MUST}:\n\n  |responsibility[idempotency]!\n
  \   Handle duplicate events gracefully. Our delivery guarantee is\n    |{em at-least-once},
  so you may receive the same |{code user_id}\n    multiple times. Use |{code user_id
  + registered_at} as a deduplication key.\n\n  |responsibility[pii-handling]!\n    All
  fields marked |{code :pii true} must follow |{link :href /policies/gdpr\n    GDPR
  compliance guidelines}. Log only hashed versions for debugging.\n\n  |responsibility[schema-validation]?\n
  \   |{em Recommended}: Validate events on ingestion. We provide validation\n    libraries
  for |{lang Python}, |{lang Go}, and |{lang TypeScript}—see\n    the |{repo user-service-contracts}
  repository.\n\n  ## Migration Guide: v1.x → v2.x\n\n  The primary breaking change
  was the introduction of the |{code emails}\n  array. Here's how to migrate:\n\n
  \ |migration-step[1] :priority high\n    ### Update Schema Definitions\n\n    Add
  |{code emails} array handling to your schema validator.\n    The |{code email} field
  still exists in v2.x for compatibility.\n\n    !code :python\n      # Before (v1.x)\n
  \     email = event['email']\n\n      # After (v2.x) - temporary bridge\n      emails
  = event.get('emails') or [event['email']]\n      primary_email = emails[0]\n\n      #
  After (v2.x) - recommended\n      emails = event['emails']  # Always present in
  v2.1+\n      primary_email = emails[0] if emails else None\n\n  |migration-step[2]
  :priority medium\n    ### Update Database Schema\n\n    If you store email in a
  singular column, either:\n    - Add an |{code emails} JSONB column alongside (recommended),
  or\n    - Migrate to a separate |{code user_emails} table\n\n    |{warn \"Do NOT
  just use emails[0]—users can reorder their email\n    preferences, and array position
  is not stable.\"}\n\n  |migration-step[3] :priority low\n    ### Update Analytics
  Queries\n\n    Any queries that join on |{code email} need updating. See\n    |{doc
  analytics-migration-guide} for Redshift and BigQuery examples.\n\n## 3. Why This
  Works in UDON\n\n**The key insight**: Data contracts need to be:\n- **Precise**
  (machine-readable schemas)\n- **Explanatory** (why decisions were made)\n- **Contextual**
  (when things changed, what's coming)\n- **Actionable** (migration steps, code examples)\n\nTraditional
  formats force you to choose:\n- **JSON Schema**: Precise, terrible for prose\n-
  **OpenAPI**: Better, but examples are strings, not structured\n- **Markdown + Schema**:
  Two files that drift apart\n- **Protobuf**: Comments are an afterthought\n\nUDON
  allows you to weave all tiers together:\n- Schema structure (elements)\n- Business
  context (prose)\n- Critical warnings"
success:
notes:
feedback:
created_at: '2025-12-24T02:23:33Z'
